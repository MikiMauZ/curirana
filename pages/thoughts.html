<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Gesti칩n de pensamientos y t칠cnicas para calmar la mente - Curirana">
  <title>Gesti칩n de Pensamientos | Curirana</title>
  <link rel="manifest" href="../manifest.json">
  <link rel="icon" href="../favicon.ico">
  
  <!-- Fuentes -->
  <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300;400;500;600;700&family=Quicksand:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Estilos CSS -->
  <link rel="stylesheet" href="../css/styles.css">
  <link rel="stylesheet" href="../css/themes.css">
  <link rel="stylesheet" href="../css/animations.css">
  <link rel="stylesheet" href="../css/responsive.css">

  <!-- Feather Icons -->
  <script src="https://unpkg.com/feather-icons"></script>
  
  <style>
    /* Estilos espec칤ficos para la p치gina de pensamientos */
    .thoughts-container {
      display: grid;
      grid-template-columns: 1fr;
      gap: var(--spacing-lg);
    }
    
    @media (min-width: 992px) {
      .thoughts-container {
        grid-template-columns: 1fr 1fr;
      }
    }
    
    .thought-exercise {
      margin-bottom: var(--spacing-lg);
      padding: var(--spacing-lg);
      background-color: var(--background-tertiary);
      border-radius: var(--border-radius-medium);
      box-shadow: var(--shadow-sm);
      transition: transform var(--transition-fast), box-shadow var(--transition-fast);
    }
    
    .thought-exercise:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-md);
    }
    
    .thought-exercise h3 {
      display: flex;
      align-items: center;
      margin-bottom: var(--spacing-md);
      color: var(--primary-color);
    }
    
    .thought-exercise h3 i {
      margin-right: var(--spacing-sm);
    }
    
    .thought-exercise p {
      margin-bottom: var(--spacing-md);
    }
    
    .thought-exercise .exercise-steps {
      list-style: none;
      padding: 0;
      margin-bottom: var(--spacing-md);
    }
    
    .thought-exercise .exercise-steps li {
      margin-bottom: var(--spacing-sm);
      padding-left: var(--spacing-lg);
      position: relative;
    }
    
    .thought-exercise .exercise-steps li:before {
      content: '';
      position: absolute;
      left: 0;
      top: 8px;
      width: 8px;
      height: 8px;
      background-color: var(--primary-color);
      border-radius: 50%;
    }
    
    .thought-exercise .exercise-actions {
      display: flex;
      justify-content: flex-end;
    }
    
    .thought-record-form {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-md);
      margin-bottom: var(--spacing-lg);
    }
    
    .thought-record-form .form-group {
      display: flex;
      flex-direction: column;
    }
    
    .thought-record-form label {
      margin-bottom: var(--spacing-xs);
      font-weight: 500;
    }
    
    .thought-record-form textarea,
    .thought-record-form input {
      padding: var(--spacing-sm);
      border: 1px solid var(--background-secondary);
      border-radius: var(--border-radius-small);
      background-color: var(--background-tertiary);
      font-family: 'Quicksand', sans-serif;
      color: var(--text-primary);
    }
    
    .thought-record-form textarea {
      min-height: 100px;
      resize: vertical;
    }
    
    .thought-record-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: var(--spacing-lg);
    }
    
    .thought-record-table th,
    .thought-record-table td {
      padding: var(--spacing-sm);
      text-align: left;
      border-bottom: 1px solid var(--background-secondary);
    }
    
    .thought-record-table th {
      font-weight: 600;
      color: var(--text-secondary);
    }
    
    .thought-record-table tr:hover {
      background-color: var(--background-secondary);
    }
    
    .thought-record-actions {
      display: flex;
      justify-content: flex-end;
      gap: var(--spacing-sm);
    }
    
    .thought-metaphor {
      display: flex;
      align-items: center;
      margin-bottom: var(--spacing-lg);
      padding: var(--spacing-lg);
      background-color: var(--background-secondary);
      border-radius: var(--border-radius-medium);
    }
    
    .thought-metaphor-icon {
      font-size: 3rem;
      margin-right: var(--spacing-lg);
      color: var(--primary-color);
      flex: 0 0 auto;
    }
    
    .thought-metaphor-content {
      flex: 1;
    }
    
    .thought-metaphor-content h3 {
      margin-bottom: var(--spacing-sm);
      color: var(--primary-color);
    }
    
    @media (max-width: 767px) {
      .thought-metaphor {
        flex-direction: column;
        text-align: center;
      }
      
      .thought-metaphor-icon {
        margin-right: 0;
        margin-bottom: var(--spacing-md);
      }
    }
    
    /* Animaci칩n para el ni침o y el algod칩n de az칰car */
    .cotton-candy-animation {
      position: relative;
      width: 100%;
      height: 200px;
      margin-bottom: var(--spacing-lg);
    }
    
    .child-figure {
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 100px;
      background-color: var(--primary-color);
      border-radius: 30px 30px 0 0;
    }
    
    .child-head {
      position: absolute;
      top: -30px;
      left: 50%;
      transform: translateX(-50%);
      width: 40px;
      height: 40px;
      background-color: var(--primary-color);
      border-radius: 50%;
    }
    
    .cotton-candy {
      position: absolute;
      top: 20px;
      left: 20%;
      width: 60px;
      height: 60px;
      background-color: var(--accent-color);
      border-radius: 50%;
      opacity: 0.8;
      transition: all 0.3s ease;
    }
    
    .cotton-candy:before {
      content: '';
      position: absolute;
      bottom: -10px;
      left: 50%;
      transform: translateX(-50%);
      width: 5px;
      height: 20px;
      background-color: var(--text-light);
      border-radius: 5px;
    }
    
    .cotton-candy.eaten {
      transform: scale(0);
      opacity: 0;
    }
    
    .cotton-candy.eaten:before {
      opacity: 0;
    }
  </style>
</head>
<body>
  <div id="app" class="theme-light">
    <div id="loader">
      <div class="frog-loader"></div>
      <p>Cargando Curirana...</p>
    </div>

    <div id="main-container" style="display: none;">
      <header id="main-header"></header>
      
      <main id="content">
        <section class="page-header">
          <h1>Gesti칩n de Pensamientos</h1>
          <p class="page-description">Aprende a observar, identificar y gestionar tus pensamientos para disminuir la ansiedad.</p>
        </section>
        
        <section class="thoughts-metaphor-section">
          <div class="section-container">
            <div class="card">
              <div class="thought-metaphor">
                <div class="thought-metaphor-icon">
                  游꼸
                </div>
                <div class="thought-metaphor-content">
                  <h3>El ni침o y el algod칩n de az칰car</h3>
                  <p>Imagina que tus pensamientos son como un ni침o que te pide insistentemente algod칩n de az칰car en la feria. El ni침o representa tu mente, t칰 eres el adulto responsable, y el algod칩n de az칰car es tu atenci칩n.</p>
                  <p>Cuando le das atenci칩n a un pensamiento, es como darle algod칩n de az칰car al ni침o: volver치 a pedirte m치s. Si en cambio, dejas de prestarle atenci칩n, poco a poco ir치 pidiendo cada vez menos hasta que dejar치 de insistir.</p>
                </div>
              </div>
              
              <div class="cotton-candy-animation">
                <div class="child-figure">
                  <div class="child-head"></div>
                </div>
                <div class="cotton-candy" id="cotton-candy"></div>
              </div>
              
              <div class="button-container text-center">
                <button id="feed-thoughts" class="btn btn-primary">Alimentar pensamiento</button>
                <button id="ignore-thoughts" class="btn">Ignorar pensamiento</button>
              </div>
            </div>
          </div>
        </section>
        
        <section class="thoughts-exercises-section">
          <div class="section-container">
            <h2>T칠cnicas para gestionar pensamientos</h2>
            
            <div class="thoughts-container">
              <div class="thought-exercise">
                <h3><i data-feather="eye"></i> Observar sin juzgar</h3>
                <p>Los pensamientos son solo informaci칩n que crea tu mente, no son hechos ni representan la realidad. Observarlos sin juzgarlos te permite tomar distancia.</p>
                <div class="exercise-steps">
                  <li>Si칠ntate c칩modamente y cierra los ojos.</li>
                  <li>Conc칠ntrate en tu respiraci칩n durante unos minutos.</li>
                  <li>Observa los pensamientos que surgen como si fueran nubes pasando por el cielo.</li>
                  <li>No te identifiques con ellos, solo obs칠rvalos ir y venir.</li>
                  <li>Cuando notes que te has distra칤do, vuelve amablemente a observar tu respiraci칩n.</li>
                </div>
                <div class="exercise-actions">
                  <button class="btn btn-primary start-exercise" data-exercise="observe">Iniciar pr치ctica</button>
                </div>
              </div>
              
              <div class="thought-exercise">
                <h3><i data-feather="edit"></i> Registro de pensamientos</h3>
                <p>Identificar y cuestionar pensamientos autom치ticos puede ayudarte a verlos con perspectiva y reducir su impacto emocional.</p>
                <div class="exercise-steps">
                  <li>Identifica una situaci칩n que te haya generado malestar.</li>
                  <li>Escribe los pensamientos autom치ticos que surgieron.</li>
                  <li>Reconoce las emociones asociadas a esos pensamientos.</li>
                  <li>Cuestiona esos pensamientos buscando interpretaciones alternativas.</li>
                  <li>Desarrolla respuestas m치s equilibradas y realistas.</li>
                </div>
                <div class="exercise-actions">
                  <button class="btn btn-primary start-exercise" data-exercise="record">Iniciar registro</button>
                </div>
              </div>
              
              <div class="thought-exercise">
                <h3><i data-feather="wind"></i> Deja pasar los pensamientos</h3>
                <p>En lugar de luchar contra tus pensamientos o tratar de suprimirlos, puedes practicar dejarlos pasar como hojas en un r칤o.</p>
                <div class="exercise-steps">
                  <li>Imagina un r칤o tranquilo con hojas flotando en la superficie.</li>
                  <li>Cuando surja un pensamiento, col칩calo mentalmente en una hoja.</li>
                  <li>Observa c칩mo la hoja con el pensamiento se aleja flotando r칤o abajo.</li>
                  <li>No intentes cambiar o eliminar el pensamiento, solo d칠jalo ir.</li>
                  <li>Contin칰a el proceso con cada nuevo pensamiento que surja.</li>
                </div>
                <div class="exercise-actions">
                  <button class="btn btn-primary start-exercise" data-exercise="leaves">Iniciar pr치ctica</button>
                </div>
              </div>
              
              <div class="thought-exercise">
                <h3><i data-feather="sun"></i> Defusi칩n cognitiva</h3>
                <p>La defusi칩n cognitiva te ayuda a separarte de tus pensamientos, reconoci칠ndolos como eventos mentales, no como verdades absolutas.</p>
                <div class="exercise-steps">
                  <li>Identifica un pensamiento recurrente que te cause malestar.</li>
                  <li>A침ade al inicio "Estoy teniendo el pensamiento de que..."</li>
                  <li>Observa c칩mo cambia tu relaci칩n con ese pensamiento.</li>
                  <li>Prueba otras t칠cnicas como agradecer a tu mente, cantar el pensamiento o decirlo con voz graciosa.</li>
                  <li>Nota c칩mo se reduce el impacto emocional del pensamiento.</li>
                </div>
                <div class="exercise-actions">
                  <button class="btn btn-primary start-exercise" data-exercise="defusion">Iniciar pr치ctica</button>
                </div>
              </div>
            </div>
          </div>
        </section>
        
        <div id="record-thoughts-modal" style="display: none;">
          <h3>Registro de pensamientos</h3>
          <form id="thought-record-form" class="thought-record-form">
            <div class="form-group">
              <label for="situation">Situaci칩n:</label>
              <textarea id="situation" placeholder="Describe brevemente la situaci칩n que te gener칩 malestar"></textarea>
            </div>
            
            <div class="form-group">
              <label for="automatic-thoughts">Pensamientos autom치ticos:</label>
              <textarea id="automatic-thoughts" placeholder="쯈u칠 pensamientos pasaron por tu mente en ese momento?"></textarea>
            </div>
            
            <div class="form-group">
              <label for="emotions">Emociones:</label>
              <textarea id="emotions" placeholder="쯈u칠 emociones sentiste? 쮺on qu칠 intensidad (1-10)?"></textarea>
            </div>
            
            <div class="form-group">
              <label for="alternative-thoughts">Pensamientos alternativos:</label>
              <textarea id="alternative-thoughts" placeholder="쯈u칠 otras interpretaciones podr칤an ser posibles?"></textarea>
            </div>
            
            <div class="form-group">
              <label for="balanced-response">Respuesta equilibrada:</label>
              <textarea id="balanced-response" placeholder="쮺u치l ser칤a una forma m치s equilibrada de ver esta situaci칩n?"></textarea>
            </div>
            
            <div class="form-actions">
              <button type="button" id="cancel-record" class="btn">Cancelar</button>
              <button type="submit" class="btn btn-primary">Guardar</button>
            </div>
          </form>
        </div>
        
        <div id="thought-exercises-modal" style="display: none;"></div>
      </main>
      
      <footer id="main-footer"></footer>
    </div>
  </div>
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
  
  <!-- Componentes -->
  <script src="../js/components-loader.js"></script>
  
  <!-- Scripts -->
  <script src="../js/firebase-config.js"></script>
  <script src="../js/auth.js"></script>
  <script src="../js/utils/ui-helpers.js"></script>
  <script src="../js/utils/date-helpers.js"></script>
  <script src="../js/utils/storage.js"></script>
  <script src="../js/modules/thoughts.js"></script>
  <script src="../js/app.js"></script>

  <script>
    // Cuando la p치gina se carga
    document.addEventListener('DOMContentLoaded', () => {
      // Mostrar la interfaz principal despu칠s de cargar
      setTimeout(() => {
        document.getElementById('loader').style.display = 'none';
        document.getElementById('main-container').style.display = 'block';
      }, 1000);
      
      // Inicializar iconos Feather
      feather.replace();
      
      // Inicializar animaci칩n de algod칩n de az칰car
      initCottonCandyAnimation();
      
      // Inicializar eventos para ejercicios
      initThoughtExercises();
    });
    
    // Inicializar animaci칩n de algod칩n de az칰car
    function initCottonCandyAnimation() {
      const feedButton = document.getElementById('feed-thoughts');
      const ignoreButton = document.getElementById('ignore-thoughts');
      const cottonCandy = document.getElementById('cotton-candy');
      
      let cottonCandyCount = 1;
      let cottonCandyTimeout;
      
      feedButton.addEventListener('click', () => {
        // Eliminar clase si existe
        cottonCandy.classList.remove('eaten');
        
        // Mostrar nuevo algod칩n
        clearTimeout(cottonCandyTimeout);
        
        // Crear nuevo algod칩n si no existe
        if (cottonCandyCount === 0) {
          setTimeout(() => {
            cottonCandy.style.display = 'block';
            cottonCandyCount = 1;
          }, 300);
        } 
        // Si existe, crear m치s algodones
        else if (cottonCandyCount < 3) {
          const newCottonCandy = document.createElement('div');
          newCottonCandy.className = 'cotton-candy';
          newCottonCandy.style.left = `${30 + cottonCandyCount * 20}%`;
          
          document.querySelector('.cotton-candy-animation').appendChild(newCottonCandy);
          cottonCandyCount++;
        }
        
        // Mostrar mensaje
        window.uiHelper.showAlert('Has alimentado el pensamiento. Ahora vendr치n m치s.', 'warning');
      });
      
      ignoreButton.addEventListener('click', () => {
        // Si no hay algodones, no hacer nada
        if (cottonCandyCount === 0) return;
        
        // Marcar todos los algodones como comidos
        document.querySelectorAll('.cotton-candy').forEach(candy => {
          candy.classList.add('eaten');
        });
        
        // Eliminar despu칠s de la animaci칩n
          cottonCandyTimeout = setTimeout(() => {
            document.querySelectorAll('.cotton-candy:not(#cotton-candy)').forEach(candy => {
              candy.remove();
            });
            
            cottonCandy.style.display = 'none';
            cottonCandyCount = 0;
          }, 500);
          
          // Mostrar mensaje
          window.uiHelper.showAlert('Has ignorado el pensamiento. Con el tiempo, vendr치n menos.', 'success');
        });
      }
    
    // Inicializar eventos para ejercicios de pensamientos
    function initThoughtExercises() {
      const exerciseButtons = document.querySelectorAll('.start-exercise');
      
      exerciseButtons.forEach(button => {
        button.addEventListener('click', () => {
          const exerciseType = button.dataset.exercise;
          openExerciseModal(exerciseType);
        });
      });
      
      // Configurar modal de registro de pensamientos
      const thoughtRecordForm = document.getElementById('thought-record-form');
      const cancelRecordButton = document.getElementById('cancel-record');
      
      if (thoughtRecordForm) {
        thoughtRecordForm.addEventListener('submit', (e) => {
          e.preventDefault();
          saveThoughtRecord();
        });
      }
      
      if (cancelRecordButton) {
        cancelRecordButton.addEventListener('click', () => {
          closeExerciseModal();
        });
      }
    }
    
    // Abrir modal de ejercicio
    function openExerciseModal(exerciseType) {
      const modal = document.getElementById('thought-exercises-modal');
      const recordModal = document.getElementById('record-thoughts-modal');
      
      if (exerciseType === 'record') {
        // Mostrar formulario de registro de pensamientos
        window.uiHelper.showModal('Registro de pensamientos', recordModal.innerHTML, {
          fullscreen: false,
          closeOnClickOutside: false,
          onClose: () => {
            // Limpiar formulario
            const form = document.getElementById('thought-record-form');
            if (form) form.reset();
          }
        });
        
        // Configurar eventos del formulario en el modal
        const modalForm = document.querySelector('.modal-body form');
        if (modalForm) {
          modalForm.addEventListener('submit', (e) => {
            e.preventDefault();
            saveThoughtRecord();
          });
          
          const cancelButton = modalForm.querySelector('button[type="button"]');
          if (cancelButton) {
            cancelButton.addEventListener('click', () => {
              closeExerciseModal();
            });
          }
        }
      } else {
        // Preparar contenido seg칰n tipo de ejercicio
        let content = '';
        let title = '';
        
        switch(exerciseType) {
          case 'observe':
            title = 'Observar sin juzgar';
            content = createObserveExerciseContent();
            break;
          case 'leaves':
            title = 'Deja pasar los pensamientos';
            content = createLeavesExerciseContent();
            break;
          case 'defusion':
            title = 'Defusi칩n cognitiva';
            content = createDefusionExerciseContent();
            break;
          default:
            title = 'Ejercicio de gesti칩n de pensamientos';
            content = '<p>Contenido no disponible para este ejercicio.</p>';
        }
        
        // Mostrar modal
        window.uiHelper.showModal(title, content, {
          fullscreen: false,
          closeOnClickOutside: true
        });
      }
    }
    
    // Cerrar modal de ejercicio
    function closeExerciseModal() {
      // Buscar el bot칩n de cerrar del modal y simular clic
      const closeButton = document.querySelector('.modal-header button');
      if (closeButton) {
        closeButton.click();
      }
    }
    
    // Guardar registro de pensamiento
    function saveThoughtRecord() {
      // Obtener datos del formulario (desde el modal)
      const situation = document.querySelector('.modal-body #situation') || document.getElementById('situation');
      const automaticThoughts = document.querySelector('.modal-body #automatic-thoughts') || document.getElementById('automatic-thoughts');
      const emotions = document.querySelector('.modal-body #emotions') || document.getElementById('emotions');
      const alternativeThoughts = document.querySelector('.modal-body #alternative-thoughts') || document.getElementById('alternative-thoughts');
      const balancedResponse = document.querySelector('.modal-body #balanced-response') || document.getElementById('balanced-response');
      
      // Validar datos
      if (!situation || !situation.value || !automaticThoughts || !automaticThoughts.value) {
        window.uiHelper.showAlert('Por favor, completa al menos la situaci칩n y los pensamientos autom치ticos', 'warning');
        return;
      }
      
      // Crear objeto de pensamiento
      const thoughtRecord = {
        situation: situation.value,
        automaticThoughts: automaticThoughts.value,
        emotions: emotions ? emotions.value : '',
        alternativeThoughts: alternativeThoughts ? alternativeThoughts.value : '',
        balancedResponse: balancedResponse ? balancedResponse.value : '',
        timestamp: new Date().toISOString(),
        userId: window.authHelper && window.authHelper.getCurrentUserId ? window.authHelper.getCurrentUserId() : 'anonymous'
      };
      
      // Guardar pensamiento
      if (window.thoughtsHelper && window.thoughtsHelper.saveThoughtRecord) {
        window.thoughtsHelper.saveThoughtRecord(thoughtRecord)
          .then(() => {
            window.uiHelper.showAlert('Pensamiento registrado correctamente', 'success');
            closeExerciseModal();
          })
          .catch(error => {
            console.error('Error al guardar pensamiento:', error);
            window.uiHelper.showAlert('Error al guardar el pensamiento', 'error');
          });
      } else {
        // Guardar en localStorage si no est치 disponible el m칩dulo
        let thoughtRecords = JSON.parse(localStorage.getItem('curirana_thoughts') || '[]');
        thoughtRecords.push(thoughtRecord);
        localStorage.setItem('curirana_thoughts', JSON.stringify(thoughtRecords));
        
        window.uiHelper.showAlert('Pensamiento registrado correctamente', 'success');
        closeExerciseModal();
      }
    }
    
    // Crear contenido para ejercicio de observaci칩n
    function createObserveExerciseContent() {
      return `
        <div class="observation-exercise">
          <p>Este ejercicio te ayudar치 a practicar la observaci칩n de tus pensamientos sin juzgarlos.</p>
          
          <div class="timer-container">
            <div class="timer-display">
              <span id="minutes">05</span>:<span id="seconds">00</span>
            </div>
            
            <div class="timer-controls">
              <button id="start-timer" class="btn btn-primary">Comenzar</button>
              <button id="pause-timer" class="btn" style="display: none;">Pausar</button>
              <button id="reset-timer" class="btn" style="display: none;">Reiniciar</button>
            </div>
          </div>
          
          <div class="exercise-instructions">
            <h4>Instrucciones:</h4>
            <ol>
              <li>Si칠ntate en una posici칩n c칩moda y cierra los ojos.</li>
              <li>Respira profundamente y centra tu atenci칩n en la respiraci칩n.</li>
              <li>Observa tus pensamientos como si fueran nubes pasando en el cielo.</li>
              <li>No intentes cambiarlos o juzgarlos, solo obs칠rvalos ir y venir.</li>
              <li>Cuando notes que te has distra칤do, vuelve amablemente a tu respiraci칩n.</li>
            </ol>
          </div>
          
          <div class="reflection-section" style="display: none;">
            <h4>Reflexi칩n:</h4>
            <p>T칩mate un momento para reflexionar sobre tu experiencia:</p>
            <textarea id="observation-reflection" placeholder="쯈u칠 notaste durante la pr치ctica? 쯈u칠 tipo de pensamientos surgieron?"></textarea>
            <button id="save-reflection" class="btn btn-primary">Guardar reflexi칩n</button>
          </div>
        </div>
        
        <script>
          // Configurar temporizador
          let timerInterval;
          let timerRunning = false;
          let totalSeconds = 5 * 60; // 5 minutos
          
          const startButton = document.getElementById('start-timer');
          const pauseButton = document.getElementById('pause-timer');
          const resetButton = document.getElementById('reset-timer');
          const minutesDisplay = document.getElementById('minutes');
          const secondsDisplay = document.getElementById('seconds');
          const reflectionSection = document.querySelector('.reflection-section');
          const saveReflectionButton = document.getElementById('save-reflection');
          
          function updateTimerDisplay() {
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            
            minutesDisplay.textContent = minutes.toString().padStart(2, '0');
            secondsDisplay.textContent = seconds.toString().padStart(2, '0');
          }
          
          function startTimer() {
            if (!timerRunning) {
              timerRunning = true;
              
              timerInterval = setInterval(() => {
                totalSeconds--;
                
                if (totalSeconds <= 0) {
                  clearInterval(timerInterval);
                  timerRunning = false;
                  
                  // Mostrar secci칩n de reflexi칩n
                  reflectionSection.style.display = 'block';
                  
                  // Ocultar controles del temporizador
                  startButton.style.display = 'none';
                  pauseButton.style.display = 'none';
                  resetButton.style.display = 'inline-block';
                }
                
                updateTimerDisplay();
              }, 1000);
              
              startButton.style.display = 'none';
              pauseButton.style.display = 'inline-block';
              resetButton.style.display = 'inline-block';
            }
          }
          
          function pauseTimer() {
            if (timerRunning) {
              clearInterval(timerInterval);
              timerRunning = false;
              
              pauseButton.style.display = 'none';
              startButton.style.display = 'inline-block';
            }
          }
          
          function resetTimer() {
            clearInterval(timerInterval);
            timerRunning = false;
            totalSeconds = 5 * 60;
            updateTimerDisplay();
            
            reflectionSection.style.display = 'none';
            resetButton.style.display = 'none';
            startButton.style.display = 'inline-block';
            pauseButton.style.display = 'none';
          }
          
          function saveReflection() {
            const reflection = document.getElementById('observation-reflection').value;
            
            if (!reflection) {
              window.uiHelper.showAlert('Por favor, escribe una reflexi칩n antes de guardar', 'warning');
              return;
            }
            
            // Guardar reflexi칩n
            let reflections = JSON.parse(localStorage.getItem('curirana_reflections') || '[]');
            reflections.push({
              type: 'observation',
              content: reflection,
              timestamp: new Date().toISOString()
            });
            
            localStorage.setItem('curirana_reflections', JSON.stringify(reflections));
            
            window.uiHelper.showAlert('Reflexi칩n guardada correctamente', 'success');
            
            // Cerrar modal
            const closeButton = document.querySelector('.modal-header button');
            if (closeButton) {
              closeButton.click();
            }
          }
          
          // Asignar eventos
          if (startButton) startButton.addEventListener('click', startTimer);
          if (pauseButton) pauseButton.addEventListener('click', pauseTimer);
          if (resetButton) resetButton.addEventListener('click', resetTimer);
          if (saveReflectionButton) saveReflectionButton.addEventListener('click', saveReflection);
        </script>
      `;
    }
    
    // Crear contenido para ejercicio de hojas en el r칤o
    function createLeavesExerciseContent() {
      return `
        <div class="leaves-exercise">
          <p>Este ejercicio te ayudar치 a practicar dejar pasar tus pensamientos como hojas en un r칤o, sin engancharte a ellos.</p>
          
          <div class="river-animation">
            <svg width="100%" height="200" viewBox="0 0 600 200" xmlns="http://www.w3.org/2000/svg">
              <!-- Fondo del r칤o -->
              <rect x="0" y="50" width="600" height="100" fill="#a1d9c9" />
              
              <!-- Ondas del r칤o -->
              <path d="M0,80 Q50,60 100,80 T200,80 T300,80 T400,80 T500,80 T600,80" fill="none" stroke="#7ebeb1" stroke-width="2" />
              <path d="M0,100 Q50,120 100,100 T200,100 T300,100 T400,100 T500,100 T600,100" fill="none" stroke="#7ebeb1" stroke-width="2" />
              <path d="M0,120 Q50,100 100,120 T200,120 T300,120 T400,120 T500,120 T600,120" fill="none" stroke="#7ebeb1" stroke-width="2" />
              
              <!-- Orillas -->
              <rect x="0" y="30" width="600" height="20" fill="#8fc0a9" />
              <rect x="0" y="150" width="600" height="20" fill="#8fc0a9" />
              
              <!-- Grupo de hojas -->
              <g id="leaves"></g>
            </svg>
          </div>
          
          <div class="thought-input">
            <textarea id="thought-input" placeholder="Escribe un pensamiento que quieras dejar ir..."></textarea>
            <button id="add-thought" class="btn btn-primary">A침adir al r칤o</button>
          </div>
          
          <div class="exercise-instructions">
            <h4>Instrucciones:</h4>
            <ol>
              <li>Identifica un pensamiento que quieras dejar ir.</li>
              <li>Escr칤belo en el campo de texto y a침치delo al r칤o.</li>
              <li>Observa c칩mo la hoja con el pensamiento se aleja flotando r칤o abajo.</li>
              <li>Repite el proceso con cada pensamiento que quieras liberar.</li>
              <li>Observa c칩mo te sientes al ver tus pensamientos alejarse.</li>
            </ol>
          </div>
        </div>
        
        <script>
          const thoughtInput = document.getElementById('thought-input');
          const addThoughtButton = document.getElementById('add-thought');
          const leavesGroup = document.getElementById('leaves');
          
          let nextLeafId = 1;
          
          function addLeafWithThought() {
            const thought = thoughtInput.value.trim();
            
            if (!thought) {
              window.uiHelper.showAlert('Por favor, escribe un pensamiento', 'warning');
              return;
            }
            
            // Crear hoja
            const leafId = `leaf-${nextLeafId++}`;
            const leafColor = getRandomLeafColor();
            
            // Crear elementos SVG
            const leafGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            leafGroup.setAttribute('id', leafId);
            leafGroup.setAttribute('transform', 'translate(-100, 100)');
            
            // Forma de la hoja
            const leafPath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            leafPath.setAttribute('d', 'M0,0 Q10,-10 20,0 T40,0 Q30,10 20,20 Q10,10 0,0 Z');
            leafPath.setAttribute('fill', leafColor);
            
            // Texto del pensamiento (limitado a 20 caracteres)
            const thoughtText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            thoughtText.setAttribute('x', '20');
            thoughtText.setAttribute('y', '10');
            thoughtText.setAttribute('text-anchor', 'middle');
            thoughtText.setAttribute('font-size', '8');
            thoughtText.setAttribute('fill', '#333');
            thoughtText.textContent = thought.length > 20 ? thought.substring(0, 17) + '...' : thought;
            
            leafGroup.appendChild(leafPath);
            leafGroup.appendChild(thoughtText);
            leavesGroup.appendChild(leafGroup);
            
            // Animar hoja
            animateLeaf(leafId);
            
            // Limpiar input
            thoughtInput.value = '';
            
            // Guardar pensamiento liberado
            let releasedThoughts = JSON.parse(localStorage.getItem('curirana_released_thoughts') || '[]');
            releasedThoughts.push({
              thought: thought,
              timestamp: new Date().toISOString()
            });
            
            localStorage.setItem('curirana_released_thoughts', JSON.stringify(releasedThoughts));
          }
          
          function getRandomLeafColor() {
            const colors = [
              '#c8d5b9', // verde claro
              '#8fc0a9', // verde medio
              '#faf3dd', // beige
              '#f4f7f2', // blanco verdoso
              '#b5a4d0'  // lavanda
            ];
            
            return colors[Math.floor(Math.random() * colors.length)];
          }
          
          function animateLeaf(leafId) {
            const leaf = document.getElementById(leafId);
            let posX = -100;
            let posY = 80 + Math.random() * 40; // Posici칩n vertical aleatoria en el r칤o
            let rotation = 0;
            
            const animate = () => {
              // Mover hoja
              posX += 2;
              rotation += 0.5;
              
              // Aplicar transformaci칩n
              leaf.setAttribute('transform', `translate(${posX}, ${posY}) rotate(${rotation})`);
              
              // Continuar animaci칩n si la hoja sigue en el SVG
              if (posX < 700) {
                requestAnimationFrame(animate);
              } else {
                // Eliminar hoja cuando sale del SVG
                leaf.remove();
              }
            };
            
            // Iniciar animaci칩n
            animate();
          }
          
          // Asignar eventos
          if (addThoughtButton) {
            addThoughtButton.addEventListener('click', addLeafWithThought);
          }
          
          if (thoughtInput) {
            thoughtInput.addEventListener('keydown', (e) => {
              if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                addLeafWithThought();
              }
            });
          }
        </script>
      `;
    }
    
    // Crear contenido para ejercicio de defusi칩n cognitiva
    function createDefusionExerciseContent() {
      return `
        <div class="defusion-exercise">
          <p>Este ejercicio te ayudar치 a practicar la defusi칩n cognitiva, una t칠cnica para separarte de tus pensamientos.</p>
          
          <div class="thought-input">
            <label for="difficult-thought">Escribe un pensamiento dif칤cil que tengas:</label>
            <textarea id="difficult-thought" placeholder="Ej: No soy capaz de manejar esto"></textarea>
          </div>
          
          <div class="defusion-techniques">
            <h4>T칠cnicas de defusi칩n:</h4>
            
            <div class="technique-card">
              <h5>Prefijo de defusi칩n</h5>
              <p>A침ade al inicio: "Estoy teniendo el pensamiento de que..."</p>
              <div class="result-box" id="prefix-result">Resultado aparecer치 aqu칤</div>
              <button class="btn btn-primary apply-technique" data-technique="prefix">Aplicar</button>
            </div>
            
            <div class="technique-card">
              <h5>Voz graciosa</h5>
              <p>Imagina que dices el pensamiento con voz de dibujos animados</p>
              <div class="result-box" id="voice-result">Resultado aparecer치 aqu칤</div>
              <button class="btn btn-primary apply-technique" data-technique="voice">Aplicar</button>
            </div>
            
            <div class="technique-card">
              <h5>Agradecimiento a la mente</h5>
              <p>Responde: "Gracias mente por ese pensamiento tan 칰til"</p>
              <div class="result-box" id="thanks-result">Resultado aparecer치 aqu칤</div>
              <button class="btn btn-primary apply-technique" data-technique="thanks">Aplicar</button>
            </div>
            
            <div class="technique-card">
              <h5>Exteriorizar el pensamiento</h5>
              <p>Imagina que el pensamiento es un objeto f칤sico fuera de ti</p>
              <div class="result-box" id="object-result">Resultado aparecer치 aqu칤</div>
              <button class="btn btn-primary apply-technique" data-technique="object">Aplicar</button>
            </div>
          </div>
          
          <div class="reflection-box">
            <h4>Reflexi칩n:</h4>
            <p>쮺칩mo te sientes despu칠s de aplicar estas t칠cnicas? 쯅otas alg칰n cambio en tu relaci칩n con el pensamiento?</p>
            <textarea id="defusion-reflection" placeholder="Escribe tu reflexi칩n aqu칤..."></textarea>
            <button id="save-defusion" class="btn btn-primary">Guardar reflexi칩n</button>
          </div>
        </div>
        
        <script>
          const difficultThoughtInput = document.getElementById('difficult-thought');
          const techniqueButtons = document.querySelectorAll('.apply-technique');
          const saveDefusionButton = document.getElementById('save-defusion');
          
          // Aplicar t칠cnica de defusi칩n
          function applyDefusionTechnique(technique) {
            const thought = difficultThoughtInput.value.trim();
            
            if (!thought) {
              window.uiHelper.showAlert('Por favor, escribe un pensamiento dif칤cil', 'warning');
              return;
            }
            
            let result = '';
            
            switch(technique) {
              case 'prefix':
                result = `Estoy teniendo el pensamiento de que ${thought.toLowerCase()}`;
                break;
              case 'voice':
                result = `"${thought}" (con voz de dibujos animados)`;
                break;
              case 'thanks':
                result = `Gracias mente por ese pensamiento tan 칰til: "${thought}"`;
                break;
              case 'object':
                result = `Veo que hay un pensamiento llamado "${thought}" flotando frente a m칤`;
                break;
            }
            
            // Actualizar caja de resultado
            const resultBox = document.getElementById(`${technique}-result`);
            if (resultBox) {
              resultBox.textContent = result;
              resultBox.classList.add('highlight');
              
              // Quitar highlight despu칠s de un tiempo
              setTimeout(() => {
                resultBox.classList.remove('highlight');
              }, 1500);
            }
          }
          
          // Guardar reflexi칩n de defusi칩n
          function saveDefusionReflection() {
            const reflection = document.getElementById('defusion-reflection').value;
            const thought = difficultThoughtInput.value;
            
            if (!reflection) {
              window.uiHelper.showAlert('Por favor, escribe una reflexi칩n antes de guardar', 'warning');
              return;
            }
            
            // Guardar reflexi칩n
            let reflections = JSON.parse(localStorage.getItem('curirana_reflections') || '[]');
            reflections.push({
              type: 'defusion',
              thought: thought,
              reflection: reflection,
              timestamp: new Date().toISOString()
            });
            
            localStorage.setItem('curirana_reflections', JSON.stringify(reflections));
            
            window.uiHelper.showAlert('Reflexi칩n guardada correctamente', 'success');
            
            // Cerrar modal
            const closeButton = document.querySelector('.modal-header button');
            if (closeButton) {
              closeButton.click();
            }
          }
          
          // Asignar eventos
          techniqueButtons.forEach(button => {
            button.addEventListener('click', () => {
              const technique = button.dataset.technique;
              applyDefusionTechnique(technique);
            });
          });
          
          if (saveDefusionButton) {
            saveDefusionButton.addEventListener('click', saveDefusionReflection);
          }
        </script>
      `;
    }
  </script>
</body>
</html>